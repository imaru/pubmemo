<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />

        <meta name="author" content="Toshihide Imaruoka" />
    
    
    <title>midori6</title>

        <script src="site_libs/header-attrs-2.23/header-attrs.js"></script>
        <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="site_libs/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
        <script src="site_libs/bootstrap-3.3.7/js/bootstrap.min.js"></script>
        <script src="site_libs/navigation-1.1/tabsets.js"></script>
        <link href="site_libs/downcute-0.1/downcute.css" rel="stylesheet" />
        <link href="site_libs/downcute-0.1/downcute_fonts_embed.css" rel="stylesheet" />
        <script src="site_libs/downcute-0.1/downcute_styles.js"></script>
        <script src="site_libs/downcute-0.1/downcute.js"></script>
        <script src="site_libs/prism-1.22/prism.js"></script>
    
    
    
        <link rel="stylesheet" href="mycss.css" type="text/css" />
    
    <!-- tabsets -->
    <script>
      $(document).ready(function () {
	  window.buildTabsets("toc");
      });
      $(document).ready(function () {
	  $('.tabset-dropdown > .nav-tabs > li').click(function () {
	      $(this).parent().toggleClass('nav-tabs-open')
	  });
      });
    </script>

    <!-- code folding -->
    
    <!-- code download -->
    
    <!-- tabsets dropdown -->

    <style type="text/css">
      .tabset-dropdown > .nav-tabs {
	  display: inline-table;
	  max-height: 500px;
	  min-height: 44px;
	  overflow-y: auto;
	  background: white;
	  border: 1px solid #ddd;
	  border-radius: 4px;
      }
      
      .tabset-dropdown > .nav-tabs > li.active:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
	  content: "&#xe258;";
	  border: none;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs > li.active {
	  display: block;
      }

      .tabset-dropdown > .nav-tabs > li.active a {
  	  padding: 0 15px !important;
      }

      .tabset-dropdown > .nav-tabs > li > a,
      .tabset-dropdown > .nav-tabs > li > a:focus,
      .tabset-dropdown > .nav-tabs > li > a:hover {
	  border: none;
	  display: inline-block;
	  border-radius: 4px;
	  background-color: transparent;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li {
	  display: block;
	  float: none;
      }
      
      .tabset-dropdown > .nav-tabs > li {
	  display: none;
	  margin-left: 0 !important;
      }
    </style>
    
</head>

<body class="preload">

   	
               <!-- downcute start -->   
   <div id="docute" class="Root theme-default">
     <div class="Page layout-narrow">
      <div class="Wrap">
        <div class="Sidebar">
          <div class="SidebarItems" id="toc">
            <ul>
            <li><a href="#glmの応用範囲を広げるロジスティック回帰など"
            id="toc-glmの応用範囲を広げるロジスティック回帰など">6.
            GLMの応用範囲を広げる–ロジスティック回帰など–</a>
            <ul>
            <li><a href="#さまざまな種類のデータで応用できるglm"
            id="toc-さまざまな種類のデータで応用できるglm">6.1
            さまざまな種類のデータで応用できるGLM</a></li>
            <li><a href="#例題上限のあるカウントデータ"
            id="toc-例題上限のあるカウントデータ">6.2
            例題：上限のあるカウントデータ</a></li>
            <li><a href="#二項分布で表現するありなしカウントデータ"
            id="toc-二項分布で表現するありなしカウントデータ">6.3
            二項分布で表現する「あり・なし」カウントデータ</a></li>
            <li><a href="#ロジスティック回帰とロジットリンク関数"
            id="toc-ロジスティック回帰とロジットリンク関数">6.4
            ロジスティック回帰とロジットリンク関数</a></li>
            <li><a href="#交互作用行の入った線形予測子"
            id="toc-交互作用行の入った線形予測子">6.5
            交互作用行の入った線形予測子</a></li>
            <li><a href="#割算値の統計モデリングはやめよう"
            id="toc-割算値の統計モデリングはやめよう">6.6
            割算値の統計モデリングはやめよう</a></li>
            <li><a href="#正規分布とその尤度"
            id="toc-正規分布とその尤度">6.7 正規分布とその尤度</a></li>
            </ul></li>
            </ul>
          </div>
          <div data-position="sidebar:post-end" class="InjectedComponents"><div class="dark-theme-toggler"><div class="toggle "><div class="toggle-track"><div class="toggle-track-check"><img  src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16"></div> <div class="toggle-track-x"><img src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16"></div></div> <div class="toggle-thumb"></div></div> <input type="checkbox" aria-label="Switch between Dark and Default theme" class="toggler-screen-reader-only"></div></div>
        </div>
        <div class="Main">
          <div class="Content" id="content"> 
   
   
      
      <div class="navbar navbar-default  navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">my public memo</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li>
        <a href="index.html">Home</a>
      </li>
      <li>
        <a href="midori1.html">緑本</a>
      </li>
      <li>
        <a href="baba1.html">馬場本1部</a>
      </li>
      <li>
        <a href="baba2.html">馬場本2部</a>
      </li>
      <li>
        <a href="baba3.html">馬場本3部</a>
      </li>
      <li>
        <a href="baba4.html">馬場本4部</a>
      </li>
      <li>
        <a href="psytech.html">技術部</a>
      </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container -->
      </div><!--/.navbar -->
        
      <h1 class="title">midori6</h1>
      
      <p class="authors">
           <span class="glyphicon glyphicon-user"></span> Toshihide
Imaruoka
      </p>
         <p class="date"><span class="glyphicon glyphicon-calendar"></span> 6/21/2022</p>
           

   
      
   
<!-- Don't indent these lines or it will mess pre blocks indentation --> 
<div class="page-content has-page-title">
<div id="glmの応用範囲を広げるロジスティック回帰など"
class="section level1">
<h1>6. GLMの応用範囲を広げる–ロジスティック回帰など–</h1>
<div id="さまざまな種類のデータで応用できるglm" class="section level2">
<h2>6.1 さまざまな種類のデータで応用できるGLM</h2>
<ul>
<li>表6.1: Rのglm()でよく使われる確率分布
<ul>
<li>離散変数か連続変数か
<ul>
<li>離散変数
<ul>
<li>二項分布：成功確率<span
class="math inline">\(p\)</span>の0/1をn試行実施したときに1となる回数</li>
<li>ポアソン分布：平均<span
class="math inline">\(\lambda\)</span>の度数データをn回取得したときに得られる値</li>
<li>負の二項分布：成功確率<span
class="math inline">\(p\)</span>の0/1でk回0が出る前に1が出た回数</li>
</ul></li>
<li>連続変数
<ul>
<li>ガンマ分布：めったに（<span
class="math inline">\(1/\lambda\)</span>)起きない事象が<span
class="math inline">\(\alpha\)</span>回起きるまでの時間</li>
<li>正規分布：負の値も取り得る連続量データ。どういうデータ？
<ul>
<li>反応時間：正規分布しない。対数正規分布？</li>
<li>正答率：正規分布しない。二項分布？</li>
<li>じゃあ、どんなデータ？</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
<div id="例題上限のあるカウントデータ" class="section level2">
<h2>6.2 例題：上限のあるカウントデータ</h2>
<ul>
<li>例題データ：ある植物の<span
class="math inline">\(個体_i\)</span>の種子<span
class="math inline">\(N_i\)</span>個を観察したときの生存数<span
class="math inline">\(y_i\)</span>個。死んでるのは<span
class="math inline">\(N_i-y_i\)</span>個。体サイズ<span
class="math inline">\(x_i\)</span>や施肥処理<span
class="math inline">\(f_i\)</span>が影響する。100個の個体を調べる。</li>
<li>データを読み込んで概要をみてみる</li>
</ul>
<pre class="r"><code>dat&lt;-read.csv(&#39;kubobook_2012-2/binomial/data4a.csv&#39;)
dat$f&lt;-as.factor(dat$f)
summary(dat)</code></pre>
<pre><code>##        N           y              x          f     
##  Min.   :8   Min.   :0.00   Min.   : 7.660   C:50  
##  1st Qu.:8   1st Qu.:3.00   1st Qu.: 9.338   T:50  
##  Median :8   Median :6.00   Median : 9.965         
##  Mean   :8   Mean   :5.08   Mean   : 9.967         
##  3rd Qu.:8   3rd Qu.:8.00   3rd Qu.:10.770         
##  Max.   :8   Max.   :8.00   Max.   :12.440</code></pre>
</div>
<div id="二項分布で表現するありなしカウントデータ"
class="section level2">
<h2>6.3 二項分布で表現する「あり・なし」カウントデータ</h2>
<ul>
<li>上限があるカウントデータだからポアソン分布では表現できない</li>
<li>二項分布
<ul>
<li><span class="math inline">\(p(y|N, q)={N \choose
y}q^y(1-q)^{N-y}\)</span>
<ul>
<li><span class="math inline">\(p(y|N, q)\)</span>:
N個中y個で事象が生起する確率。qは事象の生起確率。</li>
<li><span class="math inline">\({N \choose y}\)</span>:
場合の数。N個の観察からy個の生存種子を選び出す場合の数。どのy個でもいいのでそれのこと。</li>
</ul></li>
</ul></li>
<li><span class="math inline">\(N\)</span>を8として<span
class="math inline">\(q\)</span>を変えて二項分布を書いてみる。</li>
</ul>
<pre class="r"><code>y&lt;-seq(0,8)
N&lt;-8
d1&lt;-dbinom(y, N, 0.1)
d2&lt;-dbinom(y, N, 0.3)
d3&lt;-dbinom(y, N, 0.8)

# Rのplot()でグラフ
plot(y,d1, type=&#39;b&#39;, col=1, ylim=c(0,0.5))
par(new=T)
plot(y,d2, type=&#39;b&#39;, col=2, ylim=c(0,0.5))
par(new=T)
plot(y,d3, type=&#39;b&#39;, col=3, ylim=c(0,0.5))</code></pre>
<p><img src="midori6_files/figure-html/unnamed-chunk-2-1.png" width="768" /></p>
<pre class="r"><code># ggplot2でグラフ
# データの加工にtidyverseをつかってる
library(tidyverse)
library(ggplot2)
tdat&lt;-rbind(y,d1,d2,d3) %&gt;% t %&gt;% data.frame %&gt;% tidyr::pivot_longer(!y, names_to = &#39;d&#39;, values_to = &#39;p&#39;)

g&lt;-ggplot(tdat, aes(x=y, y=p, color=d))
g&lt;-g+geom_line()+geom_point()
plot(g)</code></pre>
<p><img src="midori6_files/figure-html/unnamed-chunk-2-2.png" width="768" /></p>
</div>
<div id="ロジスティック回帰とロジットリンク関数" class="section level2">
<h2>6.4 ロジスティック回帰とロジットリンク関数</h2>
<ul>
<li>二項分布を使ったGLM
<ul>
<li>ロジスティック回帰</li>
</ul></li>
</ul>
<div id="ロジットリンク関数" class="section level3">
<h3>6.4.1 ロジットリンク関数</h3>
<ul>
<li>ロジスティック回帰
<ul>
<li>二項分布</li>
<li>ロジットリンク関数</li>
</ul></li>
</ul>
<pre class="r"><code>x&lt;-seq(-6,6,0.1)
y&lt;-plogis(x)
plot(x,y, type=&#39;l&#39;)</code></pre>
<p><img src="midori6_files/figure-html/unnamed-chunk-3-1.png" width="768" /></p>
<pre class="r"><code>logistic &lt;- function(z) 1/(1+exp(-z))
plot(x, logistic(x), type=&#39;l&#39;)</code></pre>
<p><img src="midori6_files/figure-html/unnamed-chunk-3-2.png" width="768" /></p>
<ul>
<li>種子の生存・死亡を二項分布で表す
<ul>
<li>パラメータ<span class="math inline">\(q_i\)</span>：種子の生存確率,
<span class="math inline">\(0\leqq q_i\leqq1\)</span></li>
<li>これをうまく線形予測子と関連づけるためのリンク関数としてロジット関数を使うんだけど、ロジット関数って何っていう話の前にロジスティック関数
<ul>
<li>ロジスティック関数
<ul>
<li><span
class="math inline">\(q_i=logistic(z_i)=\frac{1}{1+exp(-z_i)}\)</span></li>
<li>変形する</li>
<li><span class="math inline">\(exp(-z)=\frac{1}{q_i}-1\)</span></li>
<li><span class="math inline">\(z_i=-log(\frac{1}{q_i}-1)\)</span></li>
<li><span
class="math inline">\(z_i=log(\frac{q_i}{1-q_i})=logit(q_i)\)</span>
(logのカッコ内を逆数にする＝符号反転)</li>
</ul></li>
<li><span class="math inline">\(q_i=logistic(z_i), z_i=\beta_1+\beta_2
x\)</span>でさまざまな<span
class="math inline">\(\beta\)</span>のときのxとqの関係</li>
</ul></li>
</ul></li>
</ul>
<pre class="r"><code>library(tidyverse)
library(ggplot2)
beta2&lt;-c(-1,2,4)
beta1&lt;-c(-3,0,2)
x&lt;-seq(-3,3,0.1)
d1&lt;-logistic(beta1[1]+beta2[2]*x)
d2&lt;-logistic(beta1[2]+beta2[2]*x)
d3&lt;-logistic(beta1[3]+beta2[2]*x)
d4&lt;-logistic(beta1[2]+beta2[1]*x)
d5&lt;-logistic(beta1[2]+beta2[2]*x)
d6&lt;-logistic(beta1[2]+beta2[3]*x)
dat2&lt;-rbind(x,d1,d2,d3) %&gt;% t %&gt;% data.frame %&gt;% tidyr::pivot_longer(!x, names_to = &#39;d&#39;, values_to = &#39;q&#39;)
dat3&lt;-rbind(x,d4,d5,d6) %&gt;% t %&gt;% data.frame %&gt;% tidyr::pivot_longer(!x, names_to = &#39;d&#39;, values_to = &#39;q&#39;)
gdat2&lt;-ggplot(dat2, aes(x=x, y=q, col=d))
gdat2&lt;-gdat2+geom_line()
gdat3&lt;-ggplot(dat3, aes(x=x, y=q, col=d))
gdat3&lt;-gdat3+geom_line()
plot(gdat2)</code></pre>
<p><img src="midori6_files/figure-html/unnamed-chunk-4-1.png" width="768" /></p>
<pre class="r"><code>plot(gdat3)</code></pre>
<p><img src="midori6_files/figure-html/unnamed-chunk-4-2.png" width="768" /></p>
</div>
<div id="パラメータ推定" class="section level3">
<h3>6.4.2 パラメータ推定</h3>
<ul>
<li>二項分布の式から尤度関数、対数尤度関数を得て、対数尤度<span
class="math inline">\(logL\)</span>を最大にする<span
class="math inline">\(q_i\)</span>をもとめる。
<ul>
<li>ただし、<span
class="math inline">\(q_i=\beta_1+\beta_2x+\beta_3f\)</span></li>
</ul></li>
<li>解析的に解くのは大変だけど、glm()がやってくれる
<ul>
<li>glm(cbind(y, N-y)~x+f, data=dat, famlily=binomial)
<ul>
<li>cbind()は列の結合。第1引数は1行2列の行列ということ。</li>
</ul></li>
</ul></li>
<li>例のデータでやってみる</li>
</ul>
<pre class="r"><code>library(tidyverse)
library(ggplot2)
res&lt;-glm(cbind(y,N-y)~x+f, data=dat, family=binomial)
print(res)</code></pre>
<pre><code>## 
## Call:  glm(formula = cbind(y, N - y) ~ x + f, family = binomial, data = dat)
## 
## Coefficients:
## (Intercept)            x           fT  
##     -19.536        1.952        2.022  
## 
## Degrees of Freedom: 99 Total (i.e. Null);  97 Residual
## Null Deviance:       499.2 
## Residual Deviance: 123   AIC: 272.2</code></pre>
<pre class="r"><code>xx&lt;-seq(7,12,0.1)
ff&lt;-rep(&#39;C&#39;,length(xx))
ff2&lt;-rep(&#39;T&#39;,length(xx))
CC&lt;-predict(res,newdata=data.frame(x=xx, f=ff), type=&#39;response&#39;)
TT&lt;-predict(res,newdata=data.frame(x=xx, f=ff2), type=&#39;response&#39;)
tfdat&lt;-rbind(xx,CC,TT) %&gt;% t %&gt;% data.frame %&gt;% tidyr::pivot_longer(!xx, names_to = &#39;f&#39;, values_to = &#39;y&#39;)
ctg&lt;-ggplot(tfdat, aes(x=xx, y=y, color=f))
ctg&lt;-ctg+geom_line()
plot(ctg)</code></pre>
<p><img src="midori6_files/figure-html/unnamed-chunk-5-1.png" width="768" /></p>
</div>
<div id="ロジットリンク関数の意味解釈" class="section level3">
<h3>6.4.3 ロジットリンク関数の意味・解釈</h3>
<ul>
<li>パラメータの解釈</li>
<li>ロジット関数
<ul>
<li><span
class="math inline">\(logit(q_i)=log\frac{q_i}{1-q}=線形予測子\)</span></li>
<li><span
class="math inline">\(\frac{1_i}{1-q_i}=exp(\beta_1+\beta_2x_i+\beta_3f_i)\)</span></li>
<li><span
class="math inline">\(\frac{1_i}{1-q_i}=exp(\beta_1)exp(\beta_2x_i)exp(\beta_3f_i)\)</span></li>
</ul></li>
<li>左辺<span
class="math inline">\(\frac{1_i}{1-q_i}\)</span>オッズ比：生存する確率/生存しない確率
<ul>
<li>右辺にパラメータの推定値を代入し、切片を省略</li>
<li><span class="math inline">\(\frac{1_i}{1-q_i}\propto
exp(1.95x_i)exp(2.02f_i)\)</span></li>
<li>体サイズが1増えると
<ul>
<li><span class="math inline">\(\frac{1_i}{1-q_i}\propto
exp(1.95x_i)exp(1.95)exp(2.02f_i)\)</span></li>
<li>となるので、exp(1.95)=7倍くらい増える</li>
</ul></li>
<li>同様に施肥処理ではexp(2.02)=7.5倍くらい増える</li>
</ul></li>
<li>オッズと「リスク」
<ul>
<li>発生確率が低いとき、リスクは近似的にはオッズ比に等しい</li>
<li>線形予測子内のある要因のパラメータのexp()分、リスクが減る/増えることになる</li>
</ul></li>
</ul>
</div>
<div id="ロジスティック回帰のモデル選択" class="section level3">
<h3>6.4.4 ロジスティック回帰のモデル選択</h3>
<ul>
<li><span class="math inline">\(x_i\)</span>と<span
class="math inline">\(f_i\)</span>を含むモデルが最も良く予測するモデルかは分からない
<ul>
<li>AICによるモデル選択を選ぼう</li>
<li>MASSパッケージのstepAIC()関数
<ul>
<li>ネストしているモデルのAICを比較して、AICが最小になるモデルを選択</li>
<li>やってみる</li>
<li>x+fモデルのAICが272.21となり最小（表6.2にはいろいろな値も含めて）</li>
</ul></li>
</ul></li>
</ul>
<pre class="r"><code>library(MASS)</code></pre>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<pre class="r"><code>stepAIC(res)</code></pre>
<pre><code>## Start:  AIC=272.21
## cbind(y, N - y) ~ x + f
## 
##        Df Deviance    AIC
## &lt;none&gt;      123.03 272.21
## - f     1   217.17 364.35
## - x     1   490.58 637.76</code></pre>
<pre><code>## 
## Call:  glm(formula = cbind(y, N - y) ~ x + f, family = binomial, data = dat)
## 
## Coefficients:
## (Intercept)            x           fT  
##     -19.536        1.952        2.022  
## 
## Degrees of Freedom: 99 Total (i.e. Null);  97 Residual
## Null Deviance:       499.2 
## Residual Deviance: 123   AIC: 272.2</code></pre>
</div>
</div>
<div id="交互作用行の入った線形予測子" class="section level2">
<h2>6.5 交互作用行の入った線形予測子</h2>
<ul>
<li>交互作用項：<span class="math inline">\(x_i\)</span>と<span
class="math inline">\(f_i\)</span>の積の効果
<ul>
<li>肥料を与えるかどうかによって体サイズの効果が全く違う、とか。</li>
</ul></li>
<li><span class="math inline">\(glm(cbind(y, N-y)\sim x*f,
family=&#39;binomial&#39;, data=dat)\)</span></li>
<li>今の例で実施してみる（下）
<ul>
<li>予測はほとんど変わらない</li>
<li>AICは交互作用項がないほうが小さい（272.21）</li>
</ul></li>
<li>交互作用項の解釈は難しい
<ul>
<li>予測の図をみる</li>
</ul></li>
<li>むやみに交互作用項を入れない</li>
<li>交互作用項を含むモデルのAICが最小になることもあるけど、つじつまを合わせてるだけのこもあるので注意</li>
</ul>
<pre class="r"><code>library(MASS)
res2&lt;-glm(cbind(y, N-y)~x*f, family=binomial, data=dat)
stepAIC(res2)</code></pre>
<pre><code>## Start:  AIC=273.61
## cbind(y, N - y) ~ x * f
## 
##        Df Deviance    AIC
## - x:f   1   123.03 272.21
## &lt;none&gt;      122.43 273.61
## 
## Step:  AIC=272.21
## cbind(y, N - y) ~ x + f
## 
##        Df Deviance    AIC
## &lt;none&gt;      123.03 272.21
## - f     1   217.17 364.35
## - x     1   490.58 637.76</code></pre>
<pre><code>## 
## Call:  glm(formula = cbind(y, N - y) ~ x + f, family = binomial, data = dat)
## 
## Coefficients:
## (Intercept)            x           fT  
##     -19.536        1.952        2.022  
## 
## Degrees of Freedom: 99 Total (i.e. Null);  97 Residual
## Null Deviance:       499.2 
## Residual Deviance: 123   AIC: 272.2</code></pre>
<pre class="r"><code>CC2&lt;-predict(res2,newdata=data.frame(x=xx, f=ff), type=&#39;response&#39;)
TT2&lt;-predict(res2,newdata=data.frame(x=xx, f=ff2), type=&#39;response&#39;)
tfdat2&lt;-rbind(xx,CC2,TT2) %&gt;% t %&gt;% data.frame %&gt;% tidyr::pivot_longer(!xx, names_to = &#39;f&#39;, values_to = &#39;y&#39;)
ctg2&lt;-ggplot(tfdat2, aes(x=xx, y=y, color=f))
ctg2&lt;-ctg+geom_line()
plot(ctg2)</code></pre>
<p><img src="midori6_files/figure-html/unnamed-chunk-7-1.png" width="768" /></p>
</div>
<div id="割算値の統計モデリングはやめよう" class="section level2">
<h2>6.6 割算値の統計モデリングはやめよう</h2>
<ul>
<li>何かを何かで割った値をデータにすることの害
<ul>
<li>情報が減る：300/1000と3/10は同じではない</li>
<li>分布の形が不明：分子も分母も誤差を持つとき、その比はどういう分布に従う？</li>
</ul></li>
</ul>
<div id="割算値いらずのオフセット項わざ" class="section level3">
<h3>6.6.1 割算値いらずのオフセット項わざ</h3>
<ul>
<li>統計モデリングでは割算や変数変換は不要
<ul>
<li>Nのうちy個生存
<ul>
<li>生存率y/Nをデータとするのではなく、yとNをデータとする。二項分布にcbind(y,N-y)を使う。</li>
</ul></li>
</ul></li>
<li>例題：単位面積あたりの個体数（e.g., 人口密度）
<ul>
<li>架空データ
<ul>
<li>森林に調査地100箇所（<span
class="math inline">\(i\)</span>は1から100まで）</li>
<li>調査地ごとの面積<span
class="math inline">\(A_i\)</span>は異なる</li>
<li>調査地<span class="math inline">\(i\)</span>の明るさ<span
class="math inline">\(x_i\)</span>を計測</li>
<li>調査地<span class="math inline">\(i\)</span>の植物個体数<span
class="math inline">\(y_i\)</span>を記録</li>
<li>個体密度が<span
class="math inline">\(x_i\)</span>にどう影響されるか</li>
</ul></li>
<li><span class="math inline">\(y_i\)</span>を<span
class="math inline">\(A_i\)</span>で割りたくなるけど、そうはしない
<ul>
<li><span
class="math inline">\(\frac{平均個体数\lambda_i}{A_i}=人口密度\)</span></li>
<li><span class="math inline">\(\lambda_i=A_i \times
人口密度\)</span></li>
<li>ここで人口密度をexp(式)とする。ここが結構謎。人口密度は負になることはない。負になることがない値をモデルに入れるときにexp()に入れるというのがよく使う技っぽい。</li>
<li><span
class="math inline">\(\lambda_i=A_iexp(\beta_i+\beta_2x_i)\)</span>:
平均個体数は人口密度に面積をかけたもの（ただし、人口密度は光に影響されると考えるので、<span
class="math inline">\(x_i\)</span>項を含む式とする</li>
<li><span
class="math inline">\(\lambda_i=exp(\beta_1+\beta_2x_i+logA_i)\)</span>
<ul>
<li>これで対数リンク関数、ポアソン分布のGLMの形</li>
<li>ただし、線形予測子の中に計数を持たない<span
class="math inline">\(logA_i\)</span>が入っている＝オフセット項
<ul>
<li>もともと、平均個体数の分母にあったものだから</li>
<li>glm()でオフセット項を指定できる</li>
</ul></li>
</ul></li>
</ul></li>
<li>オフセット項
<ul>
<li>単位面積あたり、単位時間あたりの計測に応用可能
<ul>
<li>観察時間の対数をオフセット項にする、など</li>
</ul></li>
<li>比や密度などにも応用可能
<ul>
<li>どっちもばらつきをもっててもOKだけど、それはこの本には出てこない</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="正規分布とその尤度" class="section level2">
<h2>6.7 正規分布とその尤度</h2>
<pre class="r"><code>dat2&lt;-read.csv(&#39;kubobook_2012-2/binomial/data4b.csv&#39;)
plot(dat2$A,dat2$y)</code></pre>
<p><img src="midori6_files/figure-html/unnamed-chunk-8-1.png" width="768" /></p>
<pre class="r"><code>glm(y~x, offset=log(A), family=poisson, data=dat2)</code></pre>
<pre><code>## 
## Call:  glm(formula = y ~ x, family = poisson, data = dat2, offset = log(A))
## 
## Coefficients:
## (Intercept)            x  
##      0.9731       1.0383  
## 
## Degrees of Freedom: 99 Total (i.e. Null);  98 Residual
## Null Deviance:       261.5 
## Residual Deviance: 81.61     AIC: 650.3</code></pre>
</div>
</div>
</div>

   
   
              </div>
  </div>
  </div>
  </div>
   
      

  <script>
    $(document).ready(function () {

		// add bootstrap table styles to pandoc tables
	$('tr.header').parent('thead').parent('table').addClass('table table-condensed');
		
 		
	    });
  </script>



    <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
	var script = document.createElement("script");
	script.type = "text/javascript";
	script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
	document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>
  
</body>
</html>
